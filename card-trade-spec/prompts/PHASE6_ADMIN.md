# Phase 6: 管理画面

## このフェーズのゴール
管理者専用のダッシュボード・データ管理画面の実装。

## 指示

### 1. 管理画面レイアウト `src/app/admin/layout.tsx`

- 管理者認証チェック（role='admin' でなければ `/` へリダイレクト）
- サイドバー + メインエリアのレイアウト
- サイドバーは公開サイトのヘッダー/フッターとは別のデザイン

**AdminSidebar** `src/components/layout/AdminSidebar.tsx`:
- ロゴ（小さく）
- メニュー:
  - 📊 ダッシュボード
  - 📦 商品管理
  - 💰 買取価格管理
  - 🔍 査定リクエスト
  - 📋 注文管理
  - 💬 問い合わせ
- 下部: 「サイトを表示」リンク（外部リンク）、ログアウト
- アクティブページのハイライト
- モバイル: 折りたたみ可能

### 2. ダッシュボード `src/app/admin/dashboard/page.tsx`

**StatsCard** `src/components/admin/StatsCard.tsx`:
4つの統計カード（1行4列）:
- 📝 今日の査定リクエスト数
- 💬 未対応の問い合わせ数
- 📦 今月の注文数
- 💰 今月の売上合計

各カードにアイコン + 数値 + 前月比（計算できれば）

**直近のアクティビティ**:
- 直近の査定リクエスト5件（テーブル: 日時/氏名/カテゴリ/ステータス）
- 直近の注文5件（テーブル: 日時/注文番号/顧客/金額/ステータス）
- 各行クリックで詳細ページへ遷移

### 3. 商品管理 `src/app/admin/products/page.tsx`

**一覧テーブル**:
- カラム: 画像（小サムネイル）/ 商品名 / カテゴリ / 価格 / ステータス / 更新日
- ステータスバッジ: active(緑)/sold(赤)/draft(灰)
- 検索バー（商品名検索）
- カテゴリフィルター
- ページネーション
- 「+ 新規商品」ボタン（右上）

**商品追加** `src/app/admin/products/new/page.tsx`:
**商品編集** `src/app/admin/products/[id]/edit/page.tsx`:

共通の `ProductForm` コンポーネント `src/components/admin/ProductForm.tsx`:

フォーム項目:
```
商品名       [テキスト]         必須
カテゴリ     [セレクト]         必須（categoriesテーブルから）
シリーズ     [テキスト]         任意
レアリティ   [セレクト]         任意（UR/SR/R/C/OTHER）
状態         [セレクト]         必須（mint/near_mint/good/damaged）
価格         [数値]             必須
元値         [数値]             任意（SALE表示用）
説明文       [テキストエリア]   任意
デジタル     [チェックボックス] デフォルトfalse
ステータス   [セレクト]         必須（active/sold/draft）
バッジ       [セレクト]         任意（new/sale/rare/digital/なし）
画像         [ファイルアップロード] 最低1枚
```

画像アップロード:
- ドラッグ＆ドロップ
- 複数枚対応（並び順変更可能）
- Supabase Storage `products/{product_id}/` に保存
- 既存画像の削除機能

保存処理:
1. zodバリデーション
2. `products` テーブルに INSERT/UPDATE
3. slug を自動生成（商品名からローマ字変換 or UUID短縮）
4. 画像アップロード → `product_images` テーブルに保存
5. 成功 → 一覧ページへリダイレクト

削除: 確認ダイアログ → 論理削除（status='draft'）or 物理削除

### 4. 買取価格管理 `src/app/admin/prices/page.tsx`

**PriceEditor** `src/components/admin/PriceEditor.tsx`:

- カテゴリタブで切替
- テーブル: カード名 / シリーズ / レアリティ / 美品価格 / 良品価格 / 傷あり価格
- **インライン編集**: 価格セルをクリック → 直接入力 → Enterで保存
- 各行の保存状態表示（保存中/保存完了チェック）
- 「+ 新規追加」ボタン → モーダルフォーム
- 削除ボタン（確認ダイアログ付き）
- 検索バー

### 5. 査定リクエスト管理 `src/app/admin/assessments/page.tsx`

**一覧テーブル**:
- カラム: 受付日 / 氏名 / カテゴリ / ステータス / 査定額
- ステータスフィルター
- 新しい順でソート

**詳細表示**（クリックで展開 or モーダル）:
- 申込者情報（氏名/メール/電話）
- 商品情報（カテゴリ/詳細/状態）
- 添付画像（クリックで拡大）
- 備考

**管理操作**:
- ステータス変更セレクト: pending → reviewing → quoted → accepted → completed / cancelled
- 査定金額入力フィールド（quotedステータス時に入力）
- 管理者メモ（テキストエリア）
- 保存ボタン

### 6. 注文管理 `src/app/admin/orders/page.tsx`

**一覧テーブル**:
- カラム: 注文日 / 注文番号 / 顧客名 / 合計金額 / ステータス
- ステータスフィルター

**詳細表示**:
- 注文情報（番号/日時/合計）
- 顧客情報（氏名/メール/電話）
- 配送先（郵便番号/住所）
- 注文商品一覧（名前/価格）

**管理操作**:
- ステータス変更: pending → confirmed → paid → preparing → shipped → completed / cancelled
- 追跡番号入力フィールド（shipped時に入力）
- 管理者メモ
- 保存ボタン

### 7. 問い合わせ管理 `src/app/admin/contacts/page.tsx`

**一覧テーブル**:
- カラム: 受付日 / 氏名 / 種別 / ステータス
- ステータスフィルター: 未対応/対応中/完了
- 未対応を赤いバッジで強調

**詳細表示**:
- 氏名 / メール / 種別
- 問い合わせ内容（全文）

**管理操作**:
- ステータス変更: unread → in_progress → resolved
- 管理者メモ
- 保存ボタン

### 8. 管理画面のデザイン

- 白背景ベース、シンプルで機能的
- テーブルは striped（交互背景）
- モーダルは半透明オーバーレイ + 白カード
- フォームは公開サイトと同じスタイル踏襲
- ステータスバッジの色分け統一:
  - 未対応/pending: 灰色
  - 対応中/reviewing/preparing: 青
  - 完了/completed/resolved: 緑
  - 問題/cancelled: 赤
  - 見積済/quoted/paid: オレンジ

## 完了条件

- [ ] 管理画面に adminロール以外ではアクセスできない
- [ ] ダッシュボードに統計情報が表示される
- [ ] 商品のCRUD（作成・読取・更新・削除）が全て動作する
- [ ] 商品画像のアップロード・削除が動作する
- [ ] 買取価格のインライン編集が動作する
- [ ] 査定リクエストのステータス更新・査定額入力が動作する
- [ ] 注文のステータス更新・追跡番号入力が動作する
- [ ] 問い合わせのステータス管理が動作する
- [ ] 全ての管理操作でデータがSupabaseに正しく保存される
- [ ] 管理画面がモバイルでも使用可能
